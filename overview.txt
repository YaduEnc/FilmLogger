# CineLunatic - Technical Project Overview & Architecture

CineLunatic is a premium, minimalist architectural companion for obsessive cinema and television viewers. It combines rigorous personal archiving with a privacy-focused social graph.

## 1. Technology Stack
- **Frontend**: React 18 + Vite (TypeScript)
- **Styling**: Tailwind CSS + Custom Utility Classes (clsx/tailwind-merge)
- **Authentication**: Firebase Authentication (Google Provider)
- **Database**: Firebase Firestore (NoSQL, Real-time)
- **API**: TMDB (The Movie Database) v3 API
- **Icons**: Lucide React

---

## 2. Database Architecture (Firestore)
The application uses a **read-optimized, denormalized schema** to ensure fast profile loading and scalable social interactions.

### A. Core Collections
1. **`/users`** (User Profiles)
   - `uid`, `username`, `displayName`, `photoURL`, `bio`
   - `privacy`: { `isPublic`: boolean } (Public/Private Profile Toggle)
   - `stats`: { `totalWatched`, `listCount`, `connectionCount`, ... } (Aggregated for performance)
   - **Subcollections**:
     - `logs`: User's diary entries (Movies & TV)
     - `lists`: Curated custom collections
     - `watchlist`: Future viewing
     - `favorites`: Top items

2. **`/usernames`** (Uniqueness Constraint)
   - Document ID is the lowercase username.
   - Field: `uid` (Maps username -> User ID).
   - Ensures globally unique handles during signup/profile edit.

3. **`/connections`** (The Social Graph)
   - Document ID: `{uid1}_{uid2}` (Sorted alphabetically)
   - Fields: `uids`: [uid1, uid2], `status`: "accepted", `since`: timestamp.
   - Enables O(1) checks for friendship status.

4. **`/connection_requests`**
   - Stores pending friend requests with `from`, `to`, and `status`.

5. **`/reviews`** (Community Discussions)
   - Flat collection for all reviews to enable global feeds.
   - Fields: `movieId`, `mediaType`, `authorUid`, `authorName`, `rating`, `spoilerFlag`, `visibility` ('public' | 'connections').
   - **Performance**: Author info is denormalized here to avoid N+1 joins when rendering feeds.

6. **`/comments`**
   - 1-level deep threading for reviews.
   - Fields: `reviewId`, `authorUid`, `text`, `spoilerFlag`.

7. **Atomic Counters (Distributed)**
   - Like counts are stored on `review` and `comment` documents.
   - "Likes" themselves are stored in `review_likes/{reviewId_userId}` to prevent double-voting.

---

## 3. Feature Breakdown

### A. Personal Archiving (The Core)
- **Unified Logging**: Log both **Movies** and **TV Shows** with a consistent interface.
- **Rich Metadata**: Logs include Date, Rating (0.5-5.0), Rewatch status, Tags, Mood, Location, and detailed Reviews.
- **Smart Stats**: Visual analytics of your viewing habits (Top Directors, Genres, Countries, Decades).
- **Lists System**: Create public or private thematic lists (e.g., "Cyberpunk 2024", "Comfort TV").

### B. Social Evolution (The Graph)
- **Two-Way Connections**: Explicit connection model (Request -> Accept) instead of asymmetric Following.
- **Privacy Controls**:
  - **Profile Level**: Public (visible to world) vs Private (visible only to connections).
  - **Entry Level**: Each review/log can be toggled as **Public**, **Connections Only**, or **Private**.
- **Notifications Hub**: Real-time management of incoming connection requests in the site header.

### C. Community & Discussions
- **Archival Reviews**: Long-form reviews tagged with "Spoiler" warnings.
- **Spoiler Protection**: Content is visually blurred with a "frosted glass" effect until explicitly revealed by the user.
- **Threaded Conversations**: Comment system to discuss specific reviews.
- **Discovery**: Find users by unique username handling.

### D. TV Show Integration (New)
- **Polymorphic Data Handling**: The system seamlessly distinguishes between `mediaType: 'movie'` and `mediaType: 'tv'`.
- **TV Detail Views**: Dedicated layouts showing **Seasons**, **Episode Counts**, **Creators**, **Networks**, and **Status**.
- **Unified Search**: A tabbed search interface allowing users to toggle context between Films and Series without losing filters.

---

## 4. Key Implementation Details

### TMDB Service (`lib/tmdb.ts`)
- **Polymorphic Transformation**: A central `transformMovie` function normalizes raw API data (Movie vs TV) into a single `Movie` TypeScript interface.
- **Extended Metadata**: Fetches "Created By" (Showrunners) for TV and "Director" for Movies ensuring correct credit attribution.

### Authentication & Security
- **Hybrid Profile Loading**:
  - Checks Firebase Auth for immediate session availability.
  - Fetches Firestore `/users/{uid}` for extended profile data (Bio, Stats).
  - Handles "New User" states gracefully by falling back to Auth defaults.

---

## 5. Design Philosophy: "Archival Minimalism"
- **Visuals**: High-contrast, monochromatic aesthetic (Black/White/Zinc).
- **Interactions**: Subtle micro-interactions (hover states, scale effects).
- **Mobile First**: All complex data tables (like Seasons lists or Filmographies) are responsive by design.
- **Focus**: Data density over decoration. The content (the film art) provides the color.
